name: "weather"
on:
  schedule:
    - cron: "15 0,12 * * *"
  workflow_dispatch:
jobs:
  weather:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v2
      - name: get prismic data
        uses: seanmart/query-prismic-data-action@master
        id: get-prismic-data
        with:
          ACCESS_TOKEN: ${{secrets.PRISMIC_ACCESS_TOKEN}}
          END_POINT: ${{secrets.PRISMIC_END_POINT}}
          TYPE: event
          FIELDS: id:uid,data.map.latitude,data.map.longitude
      - name: get weather data
        uses: seanmart/get-open-weather-action@master
        id: get-weather-data
        with:
          API_KEY: ${{secrets.WEATHER_ACCESS_TOKEN}}
          EXCLUDE: "minutely,hourly,daily,alerts"
          COORDINATES: ${{steps.get-prismic-data.outputs.DATA}}
      - name: replace file
        run: |
          echo ${{toJson(steps.get-weather-data.outputs.DATA)}} > data/weather.json
          git add data/weather.json
          git config --global user.name 'Sean Metcalf'
          git config --global user.email 'sean@seanmart.com'
          git commit -m "updated weather"
          git push origin master
