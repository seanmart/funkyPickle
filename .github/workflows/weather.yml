name: 'weather'
on:
  schedule:
      - cron: '15 0,12 * * *'
      - cron: '11 0 21 * * *'
jobs:
  weather:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v2
      - name: get prismic data
        uses: seanmart/query-prismic-data-action@master
        id: get-prismic-data
        with:
          ACCESS_TOKEN: ${{secrets.PRISMIC_ACCESS_TOKEN}}
          END_POINT: ${{secrets.PRISMIC_END_POINT}}
          TYPE: event
          FIELDS: id:uid,data.map.latitude,data.map.longitude
      - name: get weather data
        uses: seanmart/get-open-weather-action@master
        id: get-weather-data
        with:
          API_KEY: ${{secrets.WEATHER_ACCESS_TOKEN}}
          EXCLUDE: 'minutely,hourly,daily,alerts'
          COORDINATES: ${{steps.get-prismic-data.outputs.DATA}}
      - name: replace file
        run: |
          echo "${{steps.get-weather-data.outputs.DATA}}" > assets/weather/index.json
          git add assets/weather/index.json
          git commit -m "updated weather"
          git push
